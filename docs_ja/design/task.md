# タスク

*タスク*とは、他のOSにおける*プロセス*と同じ実行の単位です。CPUのコンテキスト
（レジスタ）と各自の仮想アドレス空間を含んでいます。

最大の違いは**Reseaにはカーネルレベルのスレッド機能がない**ことです。言い
換えると、1つのタスクには1つのスレッドしか存在できません[^1].。

## サーバ

*サーバ*とは、デバイスドライバやファイルシステム、TCP/IPなどのサービスを提供する
タスクのことです。ドキュメントやコードのコメントでは*サーバ*という言葉を使いますが、
カーネルはサーバタスクとクライアント（非サーバ）タスクを区別しません。

## ページャ

各タスク（カーネルが作成する一番最初のタスクを除く）には*ページャ*が紐付けられて
います。ページャとは、そのタスクで発生した例外を処理するタスクです。以下のような
イベント（*例外*と呼ばれます）が発生すると，カーネルは紐付いたページャにメッセージを
送り，例外を処理させます。

- **ページフォルト:** ページャタスクは`map`システムコールを使ってメモリページの
  マッピングを行います（例外がいわゆるセグメンテーションフォルトの場合はタスクを
  killします）。具体的には，ページャはタスク用の物理メモリページを確保し，
  ファイルコンテンツをそのページにコピーし，ページをマップし，メッセージを返信して
  タスクを再開させます。
- **タスク終了時:** ゼロ除算などの無効なオペコードによる例外です。
- **ABIエミュレーションフック:** タスクでABIエミュレーションが有効な場合、カーネルは
  ページャにシステムコールなどの処理を依頼します。

この*ページャ*機構は[機構とポリシーの分離](https://en.wikipedia.org/wiki/Separation_of_mechanism_and_policy)を
実現するために導入されたもので、OSの柔軟性を驚くほど向上させました。

[^1]: なお、ページャで*同一の*物理メモリページをマッピングするだけでReseaに
*スレッド*を実装することができます。ページテーブルの大きさは無視できる程度と思われます。
